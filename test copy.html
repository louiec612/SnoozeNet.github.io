<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="data:;base64,=">
  <title>Real-Time Drowsiness · Eye+Mouth CNN + TCN</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <style>
    :root { color-scheme: dark; }
    body {
      background: #0f1114;
      color: #c4ffd2;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
    }
    header { padding: 16px 20px; border-bottom: 1px solid #1e2a1e; }
    h1 { font-size: 18px; margin: 0; }
    main { padding: 16px 20px; max-width: 1100px; margin: 0 auto; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0 16px; }
    .btn {
      border: 1px solid #1e3b2e;
      padding: 8px 12px;
      border-radius: 10px;
      background: #0b1a1a;
      color: #c4ffd2;
      cursor: pointer;
    }
    .btn[disabled] { opacity: .5; cursor: not-allowed; }
    label { margin: 0 12px 0 0; cursor: pointer; }
    video, canvas { border-radius: 10px; }
    #video { width: 640px; height: 480px; background: #000; }
    #procCanvas, #downCanvas { display: none; }
    #panes { display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; }
    #stats, #baselineBox {
      background: #101612;
      border: 1px solid #1f3b2b;
      border-radius: 12px;
      padding: 12px;
    }
    #stats { flex: 1 1 520px; }
    .stat-row { display: flex; gap: 20px; flex-wrap: wrap; }
    .stat { min-width: 170px; }
    #cropsCol { min-width: 240px; }
    #cropsRow { display: flex; gap: 16px; flex-wrap: wrap; }
    .card {
      background: #0f1613;
      border: 1px solid #224b36;
      border-radius: 12px;
      padding: 10px 16px;
      min-width: 140px;
    }
    .card.active { background: #14351f; border-color: #43f78e; box-shadow: 0 0 10px #43f78e40; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .tag { display: inline-block; padding: 2px 8px; border: 1px solid #2a3; border-radius: 999px; margin-left: 8px; }
    #baselineBox img { max-width: 100%; border-radius: 8px; border: 1px solid #2a3; display: block; }
  </style>
</head>

<body>
  <header>
    <h1>Real-Time Eye+Mouth CNN + TCN (15 FPS, Per-Session μ/σ)</h1>
  </header>
  <main>
    <div class="controls">
      <button id="reqCamBtn" class="btn">Request Camera</button>
      <button id="startBtn" class="btn" disabled>Start (capture baseline + 10s μ/σ)</button>
      <button id="stopBtn" class="btn" disabled>Stop</button>
      <label><input type="checkbox" id="toggleRes"> Downscale 320×240</label>
      <label><input type="checkbox" id="toggleCrops" checked> Show Crops</label>
    </div>

    <div id="panes">
      <div>
        <video id="video" autoplay playsinline muted></video>
        
        <canvas id="procCanvas" width="640" height="480"></canvas>
        <canvas id="downCanvas" width="320" height="240"></canvas>
        
      </div>

      <div id="cropsCol">
        <div class="row" id="cropsRow">
          <div class="card" style="text-align:center">
            <h3 style="margin:6px 0">Unified Eye</h3>
            <canvas id="eyeCanvas" width="90" height="90"></canvas>
          </div>
          <div class="card" style="text-align:center">
            <h3 style="margin:6px 0">Mouth</h3>
            <canvas id="mouthCanvas" width="120" height="120"></canvas>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="card" id="pecCard">
            <h3 style="margin:4px 0">Prolonged Eye Closure</h3>
            <div id="pecStatus">Inactive</div>
          </div>
          <div class="card" id="yawnCard">
            <h3 style="margin:4px 0">Yawning</h3>
            <div id="yawnStatus">Inactive</div>
          </div>
          <div class="card" id="nodCard">
            <h3 style="margin:4px 0">Nodding Off</h3>
            <div id="nodStatus">Inactive</div>
          </div>
          <div class="card" id="blinkCard">
            <h3 style="margin:4px 0">Frequent Blink</h3>
            <div id="blinkStatus">Inactive</div>
          </div>
        </div>
      </div>

      <div id="stats">
        <div class="stat-row">
          <div class="stat">Eye: <code id="eyeState">-</code></div>
          <div class="stat">Blink: <code id="blinkState">-</code></div>
          <div class="stat">Mouth: <code id="mouthState">-</code></div>
          <div class="stat">Nod (rule): <code id="nodState">-</code></div>
        </div>
        <div class="stat-row" style="margin-top:6px;">
          <div class="stat">Yaw: <code id="yaw">-</code></div>
          <div class="stat">Pitch: <code id="pitch">-</code></div>
          <div class="stat">Roll: <code id="roll">-</code></div>
          <div class="stat">FPS: <code id="fps">0</code></div>
          <div class="stat">Dominant Eye: <code id="domEyeTxt">-</code></div>
          <div class="stat">Proc Res: <code id="procRes">-</code></div>
        </div>
        <div class="stat-row" style="margin-top:6px;">
          <div class="stat">ΔYaw (°/s): <code id="dyaw">-</code></div>
          <div class="stat">ΔPitch (°/s): <code id="dpitch">-</code></div>
          <div class="stat">ΔRoll (°/s): <code id="droll">-</code></div>
        </div>
        <div class="stat-row" style="margin-top:6px;">
          <div class="stat">TCN: <code id="tcnText">—</code></div>
        </div>
      </div>
    </div>

    <div id="baselineBox" style="margin-top:16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
        <div><strong>Baseline Snapshot</strong> <span id="baselineTime" class="tag">—</span></div>
        <button id="downloadBaselineBtn" class="btn" disabled>Download snapshot</button>
      </div>
      <div style="margin-top:8px;">
        <img id="baselineImg" alt="No baseline yet">
      </div>
      <div style="margin-top:8px;">
        <code id="normSummary">μ/σ — not ready</code>
      </div>
    </div>
  </main>

  <script src="realtime_tcn.js"></script>
</body>

</html>
